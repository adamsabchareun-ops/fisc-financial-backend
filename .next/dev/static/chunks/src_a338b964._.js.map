{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/services/crypto.ts"],"sourcesContent":["\r\n// src/services/crypto.ts\r\n\r\n// Helper to detect if we are in a browser or node-like environment\r\ndeclare const Buffer: any;\r\n\r\n// Helper to convert ArrayBuffer to Base64\r\nfunction toBase64(buffer: ArrayBuffer): string {\r\n    let binary = '';\r\n    const bytes = new Uint8Array(buffer);\r\n    const len = bytes.byteLength;\r\n    for (let i = 0; i < len; i++) {\r\n        binary += String.fromCharCode(bytes[i]);\r\n    }\r\n    // Safe check for btoa (Browser) vs Buffer (Node)\r\n    if (typeof btoa === 'function') {\r\n        return btoa(binary);\r\n    } else if (typeof Buffer !== 'undefined') {\r\n        return Buffer.from(binary, 'binary').toString('base64');\r\n    }\r\n    return ''; // Fallback\r\n}\r\n\r\n// Helper to convert Base64 to ArrayBuffer\r\nfunction fromBase64(base64: string): ArrayBuffer {\r\n    if (typeof atob === 'function') {\r\n        const binaryString = atob(base64);\r\n        const len = binaryString.length;\r\n        const bytes = new Uint8Array(len);\r\n        for (let i = 0; i < len; i++) {\r\n            bytes[i] = binaryString.charCodeAt(i);\r\n        }\r\n        return bytes.buffer;\r\n    } else if (typeof Buffer !== 'undefined') {\r\n        const buf = Buffer.from(base64, 'base64');\r\n        return buf.buffer.slice(buf.byteOffset, buf.byteOffset + buf.byteLength);\r\n    }\r\n    return new ArrayBuffer(0);\r\n}\r\n\r\nexport interface KeyPair {\r\n    publicKey: string; // Base64\r\n    privateKey: string; // Base64\r\n}\r\n\r\n// Check environment\r\nconst isWeb = typeof window !== 'undefined' && window.crypto && window.crypto.subtle;\r\n\r\n/**\r\n * Generates an ephemeral X25519 key pair for ECDH.\r\n */\r\nexport async function generateKeyPair(): Promise<KeyPair> {\r\n    if (isWeb) {\r\n        const keyPair = await window.crypto.subtle.generateKey(\r\n            {\r\n                name: 'ECDH',\r\n                namedCurve: 'P-256', // P-256 for standard web compatibility\r\n            },\r\n            true,\r\n            ['deriveKey', 'deriveBits']\r\n        );\r\n\r\n        const publicKeyBuffer = await window.crypto.subtle.exportKey('raw', keyPair.publicKey);\r\n        const privateKeyBuffer = await window.crypto.subtle.exportKey('pkcs8', keyPair.privateKey);\r\n\r\n        return {\r\n            publicKey: toBase64(publicKeyBuffer),\r\n            privateKey: toBase64(privateKeyBuffer)\r\n        };\r\n    } else {\r\n        throw new Error(\"React Native / Node implementation requires 'react-native-quick-crypto' setup.\");\r\n    }\r\n}\r\n\r\n/**\r\n * Derives a shared secret (AES-GCM key) from a local private key and a remote public key.\r\n */\r\nexport async function deriveSharedSecret(localPrivateKeyBase64: string, remotePublicKeyBase64: string): Promise<string> {\r\n    if (!isWeb) throw new Error(\"Not implemented for non-web yet\");\r\n\r\n    const localPrivateKey = await window.crypto.subtle.importKey(\r\n        'pkcs8',\r\n        fromBase64(localPrivateKeyBase64),\r\n        { name: 'ECDH', namedCurve: 'P-256' },\r\n        false,\r\n        ['deriveBits'] // We only need deriveBits to get the raw secret\r\n    );\r\n\r\n    const remotePublicKey = await window.crypto.subtle.importKey(\r\n        'raw',\r\n        fromBase64(remotePublicKeyBase64),\r\n        { name: 'ECDH', namedCurve: 'P-256' },\r\n        false,\r\n        []\r\n    );\r\n\r\n    // Derive a shared secret buffer\r\n    const sharedBits = await window.crypto.subtle.deriveBits(\r\n        { name: 'ECDH', public: remotePublicKey },\r\n        localPrivateKey,\r\n        256 // 256 bits for AES-256\r\n    );\r\n\r\n    // Return raw bits as Base64\r\n    return toBase64(sharedBits);\r\n}\r\n\r\n/**\r\n * Encrypts a message using AES-256-GCM and the shared secret.\r\n * Returns Base64 string of IV (12 bytes) + Ciphertext.\r\n */\r\nexport async function encrypt(message: string, sharedSecretBase64: string): Promise<string> {\r\n    if (!isWeb) throw new Error(\"Not implemented for non-web yet\");\r\n\r\n    const secretKey = await window.crypto.subtle.importKey(\r\n        'raw',\r\n        fromBase64(sharedSecretBase64),\r\n        { name: 'AES-GCM' },\r\n        false,\r\n        ['encrypt']\r\n    );\r\n\r\n    const iv = window.crypto.getRandomValues(new Uint8Array(12));\r\n    const encoder = new TextEncoder();\r\n    const data = encoder.encode(message);\r\n\r\n    const ciphertextBuffer = await window.crypto.subtle.encrypt(\r\n        {\r\n            name: 'AES-GCM',\r\n            iv: iv\r\n        },\r\n        secretKey,\r\n        data\r\n    );\r\n\r\n    // Concatenate IV + Ciphertext\r\n    const ciphertext = new Uint8Array(ciphertextBuffer);\r\n    const combined = new Uint8Array(iv.length + ciphertext.length);\r\n    combined.set(iv);\r\n    combined.set(ciphertext, iv.length);\r\n\r\n    return toBase64(combined.buffer);\r\n}\r\n\r\n/**\r\n * Decrypts a message using AES-256-GCM.\r\n * Input is Base64 (IV + Ciphertext).\r\n */\r\nexport async function decrypt(encryptedMessageBase64: string, sharedSecretBase64: string): Promise<string> {\r\n    if (!isWeb) throw new Error(\"Not implemented for non-web yet\");\r\n\r\n    const secretKey = await window.crypto.subtle.importKey(\r\n        'raw',\r\n        fromBase64(sharedSecretBase64),\r\n        { name: 'AES-GCM' },\r\n        false,\r\n        ['decrypt']\r\n    );\r\n\r\n    const combined = new Uint8Array(fromBase64(encryptedMessageBase64));\r\n\r\n    // Extract IV (first 12 bytes)\r\n    const iv = combined.slice(0, 12);\r\n    const ciphertext = combined.slice(12);\r\n\r\n    const decryptedBuffer = await window.crypto.subtle.decrypt(\r\n        {\r\n            name: 'AES-GCM',\r\n            iv: iv\r\n        },\r\n        secretKey,\r\n        ciphertext\r\n    );\r\n\r\n    const decoder = new TextDecoder();\r\n    return decoder.decode(decryptedBuffer);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 138, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/utils/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n\r\nif (!supabaseUrl || !supabaseKey) {\r\n    throw new Error('Missing Supabase environment variables')\r\n}\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseKey)\r\n"],"names":[],"mappings":";;;;AAEoB;AAFpB;;AAEA,MAAM;AACN,MAAM;AAEN;;AAIO,MAAM,WAAW,IAAA,iMAAY,EAAC,aAAa"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/services/signaling.ts"],"sourcesContent":["import { RealtimeChannel } from '@supabase/supabase-js'\r\nimport { supabase } from '../utils/supabase'\r\n\r\nexport type SignalType = 'HANDSHAKE_REQUEST' | 'HANDSHAKE_RESPONSE' | 'PING' | 'PONG' | 'SYNC_DATA'\r\n\r\nexport interface SignalMessage {\r\n    type: SignalType\r\n    payload: any\r\n    senderId?: string\r\n}\r\n\r\nexport class SignalingService {\r\n    private channel: RealtimeChannel | null = null\r\n    private sessionId: string\r\n\r\n    constructor(sessionId: string) {\r\n        this.sessionId = sessionId\r\n    }\r\n\r\n    /**\r\n     * Subscribes to the signaling channel for the session.\r\n     * @param onMessage Callback for receiving messages\r\n     */\r\n    public subscribe(onMessage: (msg: SignalMessage) => void) {\r\n        if (this.channel) return\r\n\r\n        this.channel = supabase.channel(`room:${this.sessionId}`)\r\n\r\n        this.channel\r\n            .on(\r\n                'broadcast',\r\n                { event: 'signal' },\r\n                (payload) => {\r\n                    // Verify payload structure if needed\r\n                    if (payload.payload && payload.payload.type) {\r\n                        onMessage(payload.payload as SignalMessage)\r\n                    }\r\n                }\r\n            )\r\n            .subscribe((status) => {\r\n                if (status === 'SUBSCRIBED') {\r\n                    console.log(`Subscribed to signaling channel: room:${this.sessionId}`)\r\n                }\r\n            })\r\n    }\r\n\r\n    /**\r\n     * Sends a signal to the peer.\r\n     * @param type The type of signal\r\n     * @param payload Data to send\r\n     */\r\n    public async sendSignal(type: SignalType, payload: any = {}) {\r\n        if (!this.channel) {\r\n            console.error('Cannot send signal: Channel not initialized')\r\n            return\r\n        }\r\n\r\n        await this.channel.send({\r\n            type: 'broadcast',\r\n            event: 'signal',\r\n            payload: { type, payload }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Clean up encryption channel\r\n     */\r\n    public unsubscribe() {\r\n        if (this.channel) {\r\n            supabase.removeChannel(this.channel)\r\n            this.channel = null\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;;AAUO,MAAM;IACD,UAAkC,KAAI;IACtC,UAAiB;IAEzB,YAAY,SAAiB,CAAE;QAC3B,IAAI,CAAC,SAAS,GAAG;IACrB;IAEA;;;KAGC,GACD,AAAO,UAAU,SAAuC,EAAE;QACtD,IAAI,IAAI,CAAC,OAAO,EAAE;QAElB,IAAI,CAAC,OAAO,GAAG,uIAAQ,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,IAAI,CAAC,SAAS,EAAE;QAExD,IAAI,CAAC,OAAO,CACP,EAAE,CACC,aACA;YAAE,OAAO;QAAS,GAClB,CAAC;YACG,qCAAqC;YACrC,IAAI,QAAQ,OAAO,IAAI,QAAQ,OAAO,CAAC,IAAI,EAAE;gBACzC,UAAU,QAAQ,OAAO;YAC7B;QACJ,GAEH,SAAS,CAAC,CAAC;YACR,IAAI,WAAW,cAAc;gBACzB,QAAQ,GAAG,CAAC,CAAC,sCAAsC,EAAE,IAAI,CAAC,SAAS,EAAE;YACzE;QACJ;IACR;IAEA;;;;KAIC,GACD,MAAa,WAAW,IAAgB,EAAE,UAAe,CAAC,CAAC,EAAE;QACzD,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACf,QAAQ,KAAK,CAAC;YACd;QACJ;QAEA,MAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;YACpB,MAAM;YACN,OAAO;YACP,SAAS;gBAAE;gBAAM;YAAQ;QAC7B;IACJ;IAEA;;KAEC,GACD,AAAO,cAAc;QACjB,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,uIAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,OAAO;YACnC,IAAI,CAAC,OAAO,GAAG;QACnB;IACJ;AACJ"}},
    {"offset": {"line": 222, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/stores/sessionStore.ts"],"sourcesContent":["// src/stores/sessionStore.ts\r\nimport { create } from 'zustand'\r\nimport { generateKeyPair, deriveSharedSecret, KeyPair, decrypt } from '../services/crypto'\r\nimport { SignalingService, SignalMessage } from '../services/signaling'\r\nimport { SyncPayload } from '../types/schema'\r\n\r\n// STATUS: 'idle' | 'generating' | 'ready' (waiting for scan) | 'connected' (shared secret established) | 'error'\r\nexport type SessionStatus = 'idle' | 'generating' | 'ready' | 'connected' | 'error';\r\n\r\ninterface SessionState {\r\n    sessionId: string | null;\r\n    status: SessionStatus;\r\n\r\n    // Local Ephemeral Keys (NEVER PERSIST)\r\n    keys: KeyPair | null;\r\n\r\n    // Remote Peer Identity\r\n    peerPublicKey: string | null;\r\n\r\n    // Derived Shared Secret (NEVER PERSIST)\r\n    sharedSecret: string | null;\r\n\r\n    // Signaling Service Instance\r\n    signaling: SignalingService | null;\r\n\r\n    // Decrypted Data\r\n    financialData: SyncPayload | null;\r\n\r\n    // Actions\r\n    initSession: () => Promise<void>;\r\n    setPeerKey: (peerKeyBase64: string) => Promise<void>;\r\n    processIncomingData: (encryptedPayload: string) => Promise<void>;\r\n    resetSession: () => void;\r\n}\r\n\r\n/**\r\n * Ephemeral Session Store\r\n * \r\n * SECURITY WARNING:\r\n * This store contains high-sensitive ephemeral cryptographic keys.\r\n * It must NEVER be persisted to localStorage, IndexedDB, or any disk storage.\r\n * It should only exist in memory for the duration of the browser tab / app session.\r\n */\r\nexport const useSessionStore = create<SessionState>((set, get) => ({\r\n    sessionId: null,\r\n    status: 'idle',\r\n    keys: null,\r\n    peerPublicKey: null,\r\n    sharedSecret: null,\r\n    signaling: null,\r\n    financialData: null,\r\n\r\n    initSession: async () => {\r\n        try {\r\n            get().resetSession();\r\n\r\n            set({ status: 'generating' });\r\n\r\n            // 1. Generate UUID for the session\r\n            const sessionId = crypto.randomUUID();\r\n\r\n            // 2. Generate Ephemeral Keys\r\n            const keys = await generateKeyPair();\r\n\r\n            // 3. Initialize Signaling\r\n            const signaling = new SignalingService(sessionId);\r\n\r\n            // 4. Subscribe to signals\r\n            signaling.subscribe((msg: SignalMessage) => {\r\n                const state = get();\r\n\r\n                // Allow processing signals even if connected (like SYNC_DATA)\r\n                switch (msg.type) {\r\n                    case 'HANDSHAKE_RESPONSE':\r\n                        console.log(\"Received Handshake Response from Peer\");\r\n                        if (msg.payload && msg.payload.publicKey) {\r\n                            state.setPeerKey(msg.payload.publicKey);\r\n                        }\r\n                        break;\r\n                    case 'PING':\r\n                        console.log(\"Received PING\");\r\n                        signaling.sendSignal('PONG', {});\r\n                        break;\r\n                    // NEW: Handle Data Sync\r\n                    case 'SYNC_DATA': // Using generic 'SYNC_DATA' or checking type in payload\r\n                        console.log(\"Received SYNC_DATA\");\r\n                        if (msg.payload && msg.payload.encryptedData) {\r\n                            state.processIncomingData(msg.payload.encryptedData);\r\n                        }\r\n                        break;\r\n                }\r\n            });\r\n\r\n            set({\r\n                sessionId,\r\n                keys,\r\n                status: 'ready',\r\n                signaling,\r\n                error: null\r\n            } as any);\r\n\r\n            await signaling.sendSignal('HANDSHAKE_REQUEST', { publicKey: keys.publicKey });\r\n\r\n            console.log(\"Session Initialized:\", sessionId);\r\n\r\n        } catch (e: any) {\r\n            console.error(\"Session Init Error:\", e);\r\n            set({ status: 'error' });\r\n        }\r\n    },\r\n\r\n    setPeerKey: async (peerKeyBase64: string) => {\r\n        const { keys } = get();\r\n        if (!keys) {\r\n            console.error(\"Cannot set peer key: No local keys generated.\");\r\n            set({ status: 'error' });\r\n            return;\r\n        }\r\n\r\n        try {\r\n            console.log(\"Setting Peer Key...\", peerKeyBase64.substring(0, 10) + \"...\");\r\n            set({ peerPublicKey: peerKeyBase64 });\r\n\r\n            // Derive Shared Secret immediately\r\n            const secret = await deriveSharedSecret(keys.privateKey, peerKeyBase64);\r\n\r\n            set({\r\n                sharedSecret: secret,\r\n                status: 'connected'\r\n            });\r\n            console.log(\"Shared Secret Derived. Connection Established.\");\r\n\r\n        } catch (e: any) {\r\n            console.error(\"Key Agreement Error:\", e);\r\n            set({ status: 'error' });\r\n        }\r\n    },\r\n\r\n    processIncomingData: async (encryptedPayload: string) => {\r\n        const { sharedSecret } = get();\r\n        if (!sharedSecret) {\r\n            console.error(\"Cannot decrypt data: No shared secret established.\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            console.log(\"Decrypting incoming data...\");\r\n            const jsonString = await decrypt(encryptedPayload, sharedSecret);\r\n            const data = JSON.parse(jsonString) as SyncPayload;\r\n\r\n            set({ financialData: data });\r\n            console.log(\"Financial Data Decrypted & Synced!\", data);\r\n        } catch (e: any) {\r\n            console.error(\"Decryption Error:\", e);\r\n            // Optionally set an error state here\r\n        }\r\n    },\r\n\r\n    resetSession: () => {\r\n        const { signaling } = get();\r\n        if (signaling) {\r\n            signaling.unsubscribe();\r\n        }\r\n\r\n        set({\r\n            sessionId: null,\r\n            status: 'idle',\r\n            keys: null,\r\n            peerPublicKey: null,\r\n            sharedSecret: null,\r\n            signaling: null,\r\n            financialData: null\r\n        });\r\n    }\r\n}))\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 365, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/components/ConnectQR.tsx"],"sourcesContent":["'use client';\r\n\r\n// src/components/ConnectQR.tsx\r\nimport React, { useEffect } from 'react';\r\nimport { useSessionStore } from '../stores/sessionStore';\r\n// import QRCode from 'react-qr-code'; // Assuming user will install this: npm install react-qr-code\r\n\r\n// Temporary stub for the QR library if it's missing types or the lib itself\r\n// In a real scenario, we'd ensure the lib is in package.json\r\n// For now, I'll assume standard usage.\r\nlet QRCode: any;\r\ntry {\r\n    QRCode = require('react-qr-code');\r\n    // Handle default export if needed\r\n    if (QRCode.default) QRCode = QRCode.default;\r\n} catch (e) {\r\n    QRCode = () => <div className=\"p-4 border border-red-500\">Error: react-qr-code not found</div>;\r\n}\r\n\r\n\r\nexport const ConnectQR = () => {\r\n    const {\r\n        sessionId,\r\n        keys,\r\n        status,\r\n        initSession,\r\n        sharedSecret\r\n    } = useSessionStore();\r\n\r\n    useEffect(() => {\r\n        // Start session generation on mount if not ready\r\n        if (status === 'idle') {\r\n            initSession();\r\n        }\r\n    }, [status, initSession]);\r\n\r\n    if (status === 'generating' || status === 'idle') {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center p-8 space-y-4\">\r\n                <div className=\"w-8 h-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin\"></div>\r\n                <p className=\"text-gray-500\">Generating Secure Keys...</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (status === 'error') {\r\n        return (\r\n            <div className=\"text-red-500 p-4\">\r\n                failed to initialize secure session. Please refresh.\r\n            </div>\r\n        )\r\n    }\r\n\r\n    if (status === 'connected') {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center p-8 space-y-4 bg-green-50 rounded-lg\">\r\n                <div className=\"text-4xl\">ðŸ”’</div>\r\n                <h2 className=\"text-xl font-bold text-green-700\">Secure Bridge Established</h2>\r\n                <p className=\"text-sm text-green-600\">End-to-End Encrypted</p>\r\n            </div>\r\n        )\r\n    }\r\n\r\n    // Status is 'ready' - Show QR\r\n    // Payload: Minimal JSON to save QR density\r\n    // s: sessionId, k: publicKey (Base64)\r\n    const payload = JSON.stringify({\r\n        s: sessionId,\r\n        k: keys?.publicKey\r\n    });\r\n\r\n    return (\r\n        <div className=\"flex flex-col items-center space-y-6 p-6 bg-white rounded-xl shadow-sm border border-gray-100\">\r\n            <div className=\"text-center space-y-2\">\r\n                <h3 className=\"text-lg font-semibold text-gray-900\">Scan to Connect</h3>\r\n                <p className=\"text-sm text-gray-500 max-w-xs mx-auto\">\r\n                    Open the Fisc Mobile App and scan this code to establish a secure, ephemeral connection.\r\n                </p>\r\n            </div>\r\n\r\n            <div className=\"p-4 bg-white rounded-lg shadow-inner border border-gray-200\">\r\n                {/* @ts-ignore - Ignoring type checks for the external lib stub */}\r\n                <QRCode\r\n                    value={payload}\r\n                    size={256}\r\n                    style={{ height: \"auto\", maxWidth: \"100%\", width: \"100%\" }}\r\n                    viewBox={`0 0 256 256`}\r\n                />\r\n            </div>\r\n\r\n            <div className=\"text-xs font-mono text-gray-400\">\r\n                Session: {sessionId?.slice(0, 8)}...\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AAEA,+BAA+B;AAC/B;AACA;;;AAJA;;;AAKA,oGAAoG;AAEpG,4EAA4E;AAC5E,6DAA6D;AAC7D,uCAAuC;AACvC,IAAI;AACJ,IAAI;IACA;IACA,kCAAkC;IAClC,IAAI,OAAO,OAAO,EAAE,SAAS,OAAO,OAAO;AAC/C,EAAE,OAAO,GAAG;IACR,SAAS,kBAAM,6LAAC;YAAI,WAAU;sBAA4B;;;;;;AAC9D;AAGO,MAAM,YAAY;;IACrB,MAAM,EACF,SAAS,EACT,IAAI,EACJ,MAAM,EACN,WAAW,EACX,YAAY,EACf,GAAG,IAAA,mJAAe;IAEnB,IAAA,0KAAS;+BAAC;YACN,iDAAiD;YACjD,IAAI,WAAW,QAAQ;gBACnB;YACJ;QACJ;8BAAG;QAAC;QAAQ;KAAY;IAExB,IAAI,WAAW,gBAAgB,WAAW,QAAQ;QAC9C,qBACI,6LAAC;YAAI,WAAU;;8BACX,6LAAC;oBAAI,WAAU;;;;;;8BACf,6LAAC;oBAAE,WAAU;8BAAgB;;;;;;;;;;;;IAGzC;IAEA,IAAI,WAAW,SAAS;QACpB,qBACI,6LAAC;YAAI,WAAU;sBAAmB;;;;;;IAI1C;IAEA,IAAI,WAAW,aAAa;QACxB,qBACI,6LAAC;YAAI,WAAU;;8BACX,6LAAC;oBAAI,WAAU;8BAAW;;;;;;8BAC1B,6LAAC;oBAAG,WAAU;8BAAmC;;;;;;8BACjD,6LAAC;oBAAE,WAAU;8BAAyB;;;;;;;;;;;;IAGlD;IAEA,8BAA8B;IAC9B,2CAA2C;IAC3C,sCAAsC;IACtC,MAAM,UAAU,KAAK,SAAS,CAAC;QAC3B,GAAG;QACH,GAAG,MAAM;IACb;IAEA,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAG,WAAU;kCAAsC;;;;;;kCACpD,6LAAC;wBAAE,WAAU;kCAAyC;;;;;;;;;;;;0BAK1D,6LAAC;gBAAI,WAAU;0BAEX,cAAA,6LAAC;oBACG,OAAO;oBACP,MAAM;oBACN,OAAO;wBAAE,QAAQ;wBAAQ,UAAU;wBAAQ,OAAO;oBAAO;oBACzD,SAAS,CAAC,WAAW,CAAC;;;;;;;;;;;0BAI9B,6LAAC;gBAAI,WAAU;;oBAAkC;oBACnC,WAAW,MAAM,GAAG;oBAAG;;;;;;;;;;;;;AAIjD;GA3Ea;;QAOL,mJAAe;;;KAPV"}},
    {"offset": {"line": 572, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/components/Dashboard.tsx"],"sourcesContent":["'use client';\r\nimport React from 'react';\r\nimport { useSessionStore } from '../stores/sessionStore';\r\n\r\nexport const Dashboard = () => {\r\n    const { financialData } = useSessionStore();\r\n\r\n    if (!financialData) return null;\r\n\r\n    const totalNetWorth = financialData.accounts.reduce((sum, acc) => sum + acc.balance_current, 0);\r\n\r\n    return (\r\n        <div className=\"w-full max-w-4xl mx-auto space-y-8 p-4\">\r\n            <header className=\"flex justify-between items-center pb-6 border-b border-gray-100\">\r\n                <h1 className=\"text-2xl font-bold text-gray-800\">Your Digital Briefcase</h1>\r\n                <span className=\"text-xs text-gray-400\">\r\n                    Synced: {new Date(financialData.timestamp).toLocaleTimeString()}\r\n                </span>\r\n            </header>\r\n\r\n            {/* Net Worth Card */}\r\n            <div className=\"bg-gradient-to-r from-blue-600 to-indigo-700 rounded-2xl p-8 text-white shadow-xl\">\r\n                <h2 className=\"text-blue-100 text-sm font-medium uppercase tracking-wider mb-2\">Total Net Worth</h2>\r\n                <div className=\"text-5xl font-bold\">\r\n                    ${totalNetWorth.toLocaleString('en-US', { minimumFractionDigits: 2 })}\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n                {/* Accounts List */}\r\n                <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-800 mb-4\">Accounts</h3>\r\n                    <div className=\"space-y-3\">\r\n                        {financialData.accounts.map(acc => (\r\n                            <div key={acc.id} className=\"flex justify-between items-center py-2 border-b border-dashed border-gray-100 last:border-0\">\r\n                                <div>\r\n                                    <p className=\"font-medium text-gray-700\">{acc.name}</p>\r\n                                    <p className=\"text-xs text-gray-400 capitalize\">{acc.type}</p>\r\n                                </div>\r\n                                <p className=\"font-semibold text-gray-900\">\r\n                                    ${acc.balance_current.toLocaleString()}\r\n                                </p>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Recent Transactions */}\r\n                <div className=\"bg-white rounded-xl shadow-sm border border-gray-100 p-6\">\r\n                    <h3 className=\"text-lg font-semibold text-gray-800 mb-4\">Recent Transactions</h3>\r\n                    <div className=\"space-y-4\">\r\n                        {financialData.transactions.slice(0, 5).map(tx => (\r\n                            <div key={tx.id} className=\"flex justify-between items-start\">\r\n                                <div>\r\n                                    <p className=\"font-medium text-gray-700\">{tx.payee}</p>\r\n                                    <p className=\"text-xs text-gray-400\">{new Date(tx.date).toLocaleDateString()}</p>\r\n                                </div>\r\n                                <p className={`font-semibold ${tx.amount < 0 ? 'text-gray-900' : 'text-green-600'}`}>\r\n                                    {tx.amount < 0 ? '-' : '+'}${Math.abs(tx.amount).toFixed(2)}\r\n                                </p>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AAEA;;;AAFA;;AAIO,MAAM,YAAY;;IACrB,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,mJAAe;IAEzC,IAAI,CAAC,eAAe,OAAO;IAE3B,MAAM,gBAAgB,cAAc,QAAQ,CAAC,MAAM,CAAC,CAAC,KAAK,MAAQ,MAAM,IAAI,eAAe,EAAE;IAE7F,qBACI,6LAAC;QAAI,WAAU;;0BACX,6LAAC;gBAAO,WAAU;;kCACd,6LAAC;wBAAG,WAAU;kCAAmC;;;;;;kCACjD,6LAAC;wBAAK,WAAU;;4BAAwB;4BAC3B,IAAI,KAAK,cAAc,SAAS,EAAE,kBAAkB;;;;;;;;;;;;;0BAKrE,6LAAC;gBAAI,WAAU;;kCACX,6LAAC;wBAAG,WAAU;kCAAkE;;;;;;kCAChF,6LAAC;wBAAI,WAAU;;4BAAqB;4BAC9B,cAAc,cAAc,CAAC,SAAS;gCAAE,uBAAuB;4BAAE;;;;;;;;;;;;;0BAI3E,6LAAC;gBAAI,WAAU;;kCAEX,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAG,WAAU;0CAA2C;;;;;;0CACzD,6LAAC;gCAAI,WAAU;0CACV,cAAc,QAAQ,CAAC,GAAG,CAAC,CAAA,oBACxB,6LAAC;wCAAiB,WAAU;;0DACxB,6LAAC;;kEACG,6LAAC;wDAAE,WAAU;kEAA6B,IAAI,IAAI;;;;;;kEAClD,6LAAC;wDAAE,WAAU;kEAAoC,IAAI,IAAI;;;;;;;;;;;;0DAE7D,6LAAC;gDAAE,WAAU;;oDAA8B;oDACrC,IAAI,eAAe,CAAC,cAAc;;;;;;;;uCANlC,IAAI,EAAE;;;;;;;;;;;;;;;;kCAc5B,6LAAC;wBAAI,WAAU;;0CACX,6LAAC;gCAAG,WAAU;0CAA2C;;;;;;0CACzD,6LAAC;gCAAI,WAAU;0CACV,cAAc,YAAY,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAA,mBACxC,6LAAC;wCAAgB,WAAU;;0DACvB,6LAAC;;kEACG,6LAAC;wDAAE,WAAU;kEAA6B,GAAG,KAAK;;;;;;kEAClD,6LAAC;wDAAE,WAAU;kEAAyB,IAAI,KAAK,GAAG,IAAI,EAAE,kBAAkB;;;;;;;;;;;;0DAE9E,6LAAC;gDAAE,WAAW,CAAC,cAAc,EAAE,GAAG,MAAM,GAAG,IAAI,kBAAkB,kBAAkB;;oDAC9E,GAAG,MAAM,GAAG,IAAI,MAAM;oDAAI;oDAAE,KAAK,GAAG,CAAC,GAAG,MAAM,EAAE,OAAO,CAAC;;;;;;;;uCANvD,GAAG,EAAE;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAe3C;GA/Da;;QACiB,mJAAe;;;KADhC"}}]
}