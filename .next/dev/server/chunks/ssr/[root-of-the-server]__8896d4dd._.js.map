{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 14, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/components/ConnectQR.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ConnectQR = registerClientReference(\n    function() { throw new Error(\"Attempted to call ConnectQR() from the server but ConnectQR is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/ConnectQR.tsx <module evaluation>\",\n    \"ConnectQR\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,YAAY,IAAA,wQAAuB,EAC5C;IAAa,MAAM,IAAI,MAAM;AAAkO,GAC/P,8DACA","ignoreList":[0]}},
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/components/ConnectQR.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ConnectQR = registerClientReference(\n    function() { throw new Error(\"Attempted to call ConnectQR() from the server but ConnectQR is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/ConnectQR.tsx\",\n    \"ConnectQR\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,YAAY,IAAA,wQAAuB,EAC5C;IAAa,MAAM,IAAI,MAAM;AAAkO,GAC/P,0CACA","ignoreList":[0]}},
    {"offset": {"line": 42, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 50, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/components/Dashboard.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const Dashboard = registerClientReference(\n    function() { throw new Error(\"Attempted to call Dashboard() from the server but Dashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/Dashboard.tsx <module evaluation>\",\n    \"Dashboard\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,YAAY,IAAA,wQAAuB,EAC5C;IAAa,MAAM,IAAI,MAAM;AAAkO,GAC/P,8DACA","ignoreList":[0]}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/components/Dashboard.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const Dashboard = registerClientReference(\n    function() { throw new Error(\"Attempted to call Dashboard() from the server but Dashboard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/Dashboard.tsx\",\n    \"Dashboard\",\n);\n"],"names":[],"mappings":";;;;AAAA,uEAAuE;AACvE;;AACO,MAAM,YAAY,IAAA,wQAAuB,EAC5C;IAAa,MAAM,IAAI,MAAM;AAAkO,GAC/P,0CACA","ignoreList":[0]}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/services/crypto.ts"],"sourcesContent":["\r\n// src/services/crypto.ts\r\n\r\n// Helper to detect if we are in a browser or node-like environment\r\ndeclare const Buffer: any;\r\n\r\n// Helper to convert ArrayBuffer to Base64\r\nfunction toBase64(buffer: ArrayBuffer): string {\r\n    let binary = '';\r\n    const bytes = new Uint8Array(buffer);\r\n    const len = bytes.byteLength;\r\n    for (let i = 0; i < len; i++) {\r\n        binary += String.fromCharCode(bytes[i]);\r\n    }\r\n    // Safe check for btoa (Browser) vs Buffer (Node)\r\n    if (typeof btoa === 'function') {\r\n        return btoa(binary);\r\n    } else if (typeof Buffer !== 'undefined') {\r\n        return Buffer.from(binary, 'binary').toString('base64');\r\n    }\r\n    return ''; // Fallback\r\n}\r\n\r\n// Helper to convert Base64 to ArrayBuffer\r\nfunction fromBase64(base64: string): ArrayBuffer {\r\n    if (typeof atob === 'function') {\r\n        const binaryString = atob(base64);\r\n        const len = binaryString.length;\r\n        const bytes = new Uint8Array(len);\r\n        for (let i = 0; i < len; i++) {\r\n            bytes[i] = binaryString.charCodeAt(i);\r\n        }\r\n        return bytes.buffer;\r\n    } else if (typeof Buffer !== 'undefined') {\r\n        const buf = Buffer.from(base64, 'base64');\r\n        return buf.buffer.slice(buf.byteOffset, buf.byteOffset + buf.byteLength);\r\n    }\r\n    return new ArrayBuffer(0);\r\n}\r\n\r\nexport interface KeyPair {\r\n    publicKey: string; // Base64\r\n    privateKey: string; // Base64\r\n}\r\n\r\n// Check environment\r\nconst isWeb = typeof window !== 'undefined' && window.crypto && window.crypto.subtle;\r\n\r\n/**\r\n * Generates an ephemeral X25519 key pair for ECDH.\r\n */\r\nexport async function generateKeyPair(): Promise<KeyPair> {\r\n    if (isWeb) {\r\n        const keyPair = await window.crypto.subtle.generateKey(\r\n            {\r\n                name: 'ECDH',\r\n                namedCurve: 'P-256', // P-256 for standard web compatibility\r\n            },\r\n            true,\r\n            ['deriveKey', 'deriveBits']\r\n        );\r\n\r\n        const publicKeyBuffer = await window.crypto.subtle.exportKey('raw', keyPair.publicKey);\r\n        const privateKeyBuffer = await window.crypto.subtle.exportKey('pkcs8', keyPair.privateKey);\r\n\r\n        return {\r\n            publicKey: toBase64(publicKeyBuffer),\r\n            privateKey: toBase64(privateKeyBuffer)\r\n        };\r\n    } else {\r\n        throw new Error(\"React Native / Node implementation requires 'react-native-quick-crypto' setup.\");\r\n    }\r\n}\r\n\r\n/**\r\n * Derives a shared secret (AES-GCM key) from a local private key and a remote public key.\r\n */\r\nexport async function deriveSharedSecret(localPrivateKeyBase64: string, remotePublicKeyBase64: string): Promise<string> {\r\n    if (!isWeb) throw new Error(\"Not implemented for non-web yet\");\r\n\r\n    const localPrivateKey = await window.crypto.subtle.importKey(\r\n        'pkcs8',\r\n        fromBase64(localPrivateKeyBase64),\r\n        { name: 'ECDH', namedCurve: 'P-256' },\r\n        false,\r\n        ['deriveBits'] // We only need deriveBits to get the raw secret\r\n    );\r\n\r\n    const remotePublicKey = await window.crypto.subtle.importKey(\r\n        'raw',\r\n        fromBase64(remotePublicKeyBase64),\r\n        { name: 'ECDH', namedCurve: 'P-256' },\r\n        false,\r\n        []\r\n    );\r\n\r\n    // Derive a shared secret buffer\r\n    const sharedBits = await window.crypto.subtle.deriveBits(\r\n        { name: 'ECDH', public: remotePublicKey },\r\n        localPrivateKey,\r\n        256 // 256 bits for AES-256\r\n    );\r\n\r\n    // Return raw bits as Base64\r\n    return toBase64(sharedBits);\r\n}\r\n\r\n/**\r\n * Encrypts a message using AES-256-GCM and the shared secret.\r\n * Returns Base64 string of IV (12 bytes) + Ciphertext.\r\n */\r\nexport async function encrypt(message: string, sharedSecretBase64: string): Promise<string> {\r\n    if (!isWeb) throw new Error(\"Not implemented for non-web yet\");\r\n\r\n    const secretKey = await window.crypto.subtle.importKey(\r\n        'raw',\r\n        fromBase64(sharedSecretBase64),\r\n        { name: 'AES-GCM' },\r\n        false,\r\n        ['encrypt']\r\n    );\r\n\r\n    const iv = window.crypto.getRandomValues(new Uint8Array(12));\r\n    const encoder = new TextEncoder();\r\n    const data = encoder.encode(message);\r\n\r\n    const ciphertextBuffer = await window.crypto.subtle.encrypt(\r\n        {\r\n            name: 'AES-GCM',\r\n            iv: iv\r\n        },\r\n        secretKey,\r\n        data\r\n    );\r\n\r\n    // Concatenate IV + Ciphertext\r\n    const ciphertext = new Uint8Array(ciphertextBuffer);\r\n    const combined = new Uint8Array(iv.length + ciphertext.length);\r\n    combined.set(iv);\r\n    combined.set(ciphertext, iv.length);\r\n\r\n    return toBase64(combined.buffer);\r\n}\r\n\r\n/**\r\n * Decrypts a message using AES-256-GCM.\r\n * Input is Base64 (IV + Ciphertext).\r\n */\r\nexport async function decrypt(encryptedMessageBase64: string, sharedSecretBase64: string): Promise<string> {\r\n    if (!isWeb) throw new Error(\"Not implemented for non-web yet\");\r\n\r\n    const secretKey = await window.crypto.subtle.importKey(\r\n        'raw',\r\n        fromBase64(sharedSecretBase64),\r\n        { name: 'AES-GCM' },\r\n        false,\r\n        ['decrypt']\r\n    );\r\n\r\n    const combined = new Uint8Array(fromBase64(encryptedMessageBase64));\r\n\r\n    // Extract IV (first 12 bytes)\r\n    const iv = combined.slice(0, 12);\r\n    const ciphertext = combined.slice(12);\r\n\r\n    const decryptedBuffer = await window.crypto.subtle.decrypt(\r\n        {\r\n            name: 'AES-GCM',\r\n            iv: iv\r\n        },\r\n        secretKey,\r\n        ciphertext\r\n    );\r\n\r\n    const decoder = new TextDecoder();\r\n    return decoder.decode(decryptedBuffer);\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 204, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/utils/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n\r\nif (!supabaseUrl || !supabaseKey) {\r\n    throw new Error('Missing Supabase environment variables')\r\n}\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseKey)\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAEN;;AAIO,MAAM,WAAW,IAAA,8LAAY,EAAC,aAAa"}},
    {"offset": {"line": 219, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/services/signaling.ts"],"sourcesContent":["import { RealtimeChannel } from '@supabase/supabase-js'\r\nimport { supabase } from '../utils/supabase'\r\n\r\nexport type SignalType = 'HANDSHAKE_REQUEST' | 'HANDSHAKE_RESPONSE' | 'PING' | 'PONG' | 'SYNC_DATA'\r\n\r\nexport interface SignalMessage {\r\n    type: SignalType\r\n    payload: any\r\n    senderId?: string\r\n}\r\n\r\nexport class SignalingService {\r\n    private channel: RealtimeChannel | null = null\r\n    private sessionId: string\r\n\r\n    constructor(sessionId: string) {\r\n        this.sessionId = sessionId\r\n    }\r\n\r\n    /**\r\n     * Subscribes to the signaling channel for the session.\r\n     * @param onMessage Callback for receiving messages\r\n     */\r\n    public subscribe(onMessage: (msg: SignalMessage) => void) {\r\n        if (this.channel) return\r\n\r\n        this.channel = supabase.channel(`room:${this.sessionId}`)\r\n\r\n        this.channel\r\n            .on(\r\n                'broadcast',\r\n                { event: 'signal' },\r\n                (payload) => {\r\n                    // Verify payload structure if needed\r\n                    if (payload.payload && payload.payload.type) {\r\n                        onMessage(payload.payload as SignalMessage)\r\n                    }\r\n                }\r\n            )\r\n            .subscribe((status) => {\r\n                if (status === 'SUBSCRIBED') {\r\n                    console.log(`Subscribed to signaling channel: room:${this.sessionId}`)\r\n                }\r\n            })\r\n    }\r\n\r\n    /**\r\n     * Sends a signal to the peer.\r\n     * @param type The type of signal\r\n     * @param payload Data to send\r\n     */\r\n    public async sendSignal(type: SignalType, payload: any = {}) {\r\n        if (!this.channel) {\r\n            console.error('Cannot send signal: Channel not initialized')\r\n            return\r\n        }\r\n\r\n        await this.channel.send({\r\n            type: 'broadcast',\r\n            event: 'signal',\r\n            payload: { type, payload }\r\n        })\r\n    }\r\n\r\n    /**\r\n     * Clean up encryption channel\r\n     */\r\n    public unsubscribe() {\r\n        if (this.channel) {\r\n            supabase.removeChannel(this.channel)\r\n            this.channel = null\r\n        }\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AACA;;AAUO,MAAM;IACD,UAAkC,KAAI;IACtC,UAAiB;IAEzB,YAAY,SAAiB,CAAE;QAC3B,IAAI,CAAC,SAAS,GAAG;IACrB;IAEA;;;KAGC,GACD,AAAO,UAAU,SAAuC,EAAE;QACtD,IAAI,IAAI,CAAC,OAAO,EAAE;QAElB,IAAI,CAAC,OAAO,GAAG,oIAAQ,CAAC,OAAO,CAAC,CAAC,KAAK,EAAE,IAAI,CAAC,SAAS,EAAE;QAExD,IAAI,CAAC,OAAO,CACP,EAAE,CACC,aACA;YAAE,OAAO;QAAS,GAClB,CAAC;YACG,qCAAqC;YACrC,IAAI,QAAQ,OAAO,IAAI,QAAQ,OAAO,CAAC,IAAI,EAAE;gBACzC,UAAU,QAAQ,OAAO;YAC7B;QACJ,GAEH,SAAS,CAAC,CAAC;YACR,IAAI,WAAW,cAAc;gBACzB,QAAQ,GAAG,CAAC,CAAC,sCAAsC,EAAE,IAAI,CAAC,SAAS,EAAE;YACzE;QACJ;IACR;IAEA;;;;KAIC,GACD,MAAa,WAAW,IAAgB,EAAE,UAAe,CAAC,CAAC,EAAE;QACzD,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACf,QAAQ,KAAK,CAAC;YACd;QACJ;QAEA,MAAM,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC;YACpB,MAAM;YACN,OAAO;YACP,SAAS;gBAAE;gBAAM;YAAQ;QAC7B;IACJ;IAEA;;KAEC,GACD,AAAO,cAAc;QACjB,IAAI,IAAI,CAAC,OAAO,EAAE;YACd,oIAAQ,CAAC,aAAa,CAAC,IAAI,CAAC,OAAO;YACnC,IAAI,CAAC,OAAO,GAAG;QACnB;IACJ;AACJ"}},
    {"offset": {"line": 281, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/stores/sessionStore.ts"],"sourcesContent":["// src/stores/sessionStore.ts\r\nimport { create } from 'zustand'\r\nimport { generateKeyPair, deriveSharedSecret, KeyPair, decrypt } from '../services/crypto'\r\nimport { SignalingService, SignalMessage } from '../services/signaling'\r\nimport { SyncPayload } from '../types/schema'\r\n\r\n// STATUS: 'idle' | 'generating' | 'ready' (waiting for scan) | 'connected' (shared secret established) | 'error'\r\nexport type SessionStatus = 'idle' | 'generating' | 'ready' | 'connected' | 'error';\r\n\r\ninterface SessionState {\r\n    sessionId: string | null;\r\n    status: SessionStatus;\r\n\r\n    // Local Ephemeral Keys (NEVER PERSIST)\r\n    keys: KeyPair | null;\r\n\r\n    // Remote Peer Identity\r\n    peerPublicKey: string | null;\r\n\r\n    // Derived Shared Secret (NEVER PERSIST)\r\n    sharedSecret: string | null;\r\n\r\n    // Signaling Service Instance\r\n    signaling: SignalingService | null;\r\n\r\n    // Decrypted Data\r\n    financialData: SyncPayload | null;\r\n\r\n    // Actions\r\n    initSession: () => Promise<void>;\r\n    setPeerKey: (peerKeyBase64: string) => Promise<void>;\r\n    processIncomingData: (encryptedPayload: string) => Promise<void>;\r\n    resetSession: () => void;\r\n}\r\n\r\n/**\r\n * Ephemeral Session Store\r\n * \r\n * SECURITY WARNING:\r\n * This store contains high-sensitive ephemeral cryptographic keys.\r\n * It must NEVER be persisted to localStorage, IndexedDB, or any disk storage.\r\n * It should only exist in memory for the duration of the browser tab / app session.\r\n */\r\nexport const useSessionStore = create<SessionState>((set, get) => ({\r\n    sessionId: null,\r\n    status: 'idle',\r\n    keys: null,\r\n    peerPublicKey: null,\r\n    sharedSecret: null,\r\n    signaling: null,\r\n    financialData: null,\r\n\r\n    initSession: async () => {\r\n        try {\r\n            get().resetSession();\r\n\r\n            set({ status: 'generating' });\r\n\r\n            // 1. Generate UUID for the session\r\n            const sessionId = crypto.randomUUID();\r\n\r\n            // 2. Generate Ephemeral Keys\r\n            const keys = await generateKeyPair();\r\n\r\n            // 3. Initialize Signaling\r\n            const signaling = new SignalingService(sessionId);\r\n\r\n            // 4. Subscribe to signals\r\n            signaling.subscribe((msg: SignalMessage) => {\r\n                const state = get();\r\n\r\n                // Allow processing signals even if connected (like SYNC_DATA)\r\n                switch (msg.type) {\r\n                    case 'HANDSHAKE_RESPONSE':\r\n                        console.log(\"Received Handshake Response from Peer\");\r\n                        if (msg.payload && msg.payload.publicKey) {\r\n                            state.setPeerKey(msg.payload.publicKey);\r\n                        }\r\n                        break;\r\n                    case 'PING':\r\n                        console.log(\"Received PING\");\r\n                        signaling.sendSignal('PONG', {});\r\n                        break;\r\n                    // NEW: Handle Data Sync\r\n                    case 'SYNC_DATA': // Using generic 'SYNC_DATA' or checking type in payload\r\n                        console.log(\"Received SYNC_DATA\");\r\n                        if (msg.payload && msg.payload.encryptedData) {\r\n                            state.processIncomingData(msg.payload.encryptedData);\r\n                        }\r\n                        break;\r\n                }\r\n            });\r\n\r\n            set({\r\n                sessionId,\r\n                keys,\r\n                status: 'ready',\r\n                signaling,\r\n                error: null\r\n            } as any);\r\n\r\n            await signaling.sendSignal('HANDSHAKE_REQUEST', { publicKey: keys.publicKey });\r\n\r\n            console.log(\"Session Initialized:\", sessionId);\r\n\r\n        } catch (e: any) {\r\n            console.error(\"Session Init Error:\", e);\r\n            set({ status: 'error' });\r\n        }\r\n    },\r\n\r\n    setPeerKey: async (peerKeyBase64: string) => {\r\n        const { keys } = get();\r\n        if (!keys) {\r\n            console.error(\"Cannot set peer key: No local keys generated.\");\r\n            set({ status: 'error' });\r\n            return;\r\n        }\r\n\r\n        try {\r\n            console.log(\"Setting Peer Key...\", peerKeyBase64.substring(0, 10) + \"...\");\r\n            set({ peerPublicKey: peerKeyBase64 });\r\n\r\n            // Derive Shared Secret immediately\r\n            const secret = await deriveSharedSecret(keys.privateKey, peerKeyBase64);\r\n\r\n            set({\r\n                sharedSecret: secret,\r\n                status: 'connected'\r\n            });\r\n            console.log(\"Shared Secret Derived. Connection Established.\");\r\n\r\n        } catch (e: any) {\r\n            console.error(\"Key Agreement Error:\", e);\r\n            set({ status: 'error' });\r\n        }\r\n    },\r\n\r\n    processIncomingData: async (encryptedPayload: string) => {\r\n        const { sharedSecret } = get();\r\n        if (!sharedSecret) {\r\n            console.error(\"Cannot decrypt data: No shared secret established.\");\r\n            return;\r\n        }\r\n\r\n        try {\r\n            console.log(\"Decrypting incoming data...\");\r\n            const jsonString = await decrypt(encryptedPayload, sharedSecret);\r\n            const data = JSON.parse(jsonString) as SyncPayload;\r\n\r\n            set({ financialData: data });\r\n            console.log(\"Financial Data Decrypted & Synced!\", data);\r\n        } catch (e: any) {\r\n            console.error(\"Decryption Error:\", e);\r\n            // Optionally set an error state here\r\n        }\r\n    },\r\n\r\n    resetSession: () => {\r\n        const { signaling } = get();\r\n        if (signaling) {\r\n            signaling.unsubscribe();\r\n        }\r\n\r\n        set({\r\n            sessionId: null,\r\n            status: 'idle',\r\n            keys: null,\r\n            peerPublicKey: null,\r\n            sharedSecret: null,\r\n            signaling: null,\r\n            financialData: null\r\n        });\r\n    }\r\n}))\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 421, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/app/page.tsx"],"sourcesContent":["import React from 'react';\r\nimport { ConnectQR } from '../components/ConnectQR';\r\nimport { Dashboard } from '../components/Dashboard';\r\nimport { useSessionStore } from '../stores/sessionStore';\r\n\r\nexport default function Home() {\r\n    const { financialData } = useSessionStore();\r\n\r\n    return (\r\n        <main className=\"min-h-screen bg-gray-50 flex flex-col items-center justify-center p-4\">\r\n            {/* Header / Brand */}\r\n            <div className=\"mb-10 text-center\">\r\n                <h1 className=\"text-3xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600\">\r\n                    Fisc Financial\r\n                </h1>\r\n                <p className=\"text-gray-400 text-sm mt-2\">Secure Backend Bridge</p>\r\n            </div>\r\n\r\n            <div className=\"w-full max-w-5xl\">\r\n                {!financialData ? (\r\n                    <div className=\"flex justify-center\">\r\n                        <ConnectQR />\r\n                    </div>\r\n                ) : (\r\n                    <Dashboard />\r\n                )}\r\n            </div>\r\n\r\n            {/* Footer */}\r\n            <div className=\"mt-12 text-center text-xs text-gray-300\">\r\n                <p>End-to-End Encrypted Session</p>\r\n                <p>No data is persisted on this server.</p>\r\n            </div>\r\n        </main>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;;;AAEe,SAAS;IACpB,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,gJAAe;IAEzC,qBACI,8OAAC;QAAK,WAAU;;0BAEZ,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAG,WAAU;kCAAqG;;;;;;kCAGnH,8OAAC;wBAAE,WAAU;kCAA6B;;;;;;;;;;;;0BAG9C,8OAAC;gBAAI,WAAU;0BACV,CAAC,8BACE,8OAAC;oBAAI,WAAU;8BACX,cAAA,8OAAC,4IAAS;;;;;;;;;yCAGd,8OAAC,4IAAS;;;;;;;;;;0BAKlB,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;kCAAE;;;;;;kCACH,8OAAC;kCAAE;;;;;;;;;;;;;;;;;;AAInB"}}]
}