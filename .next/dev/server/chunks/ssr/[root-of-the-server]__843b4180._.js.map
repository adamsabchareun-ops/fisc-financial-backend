{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/utils/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\nconst supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n\r\nif (!supabaseUrl || !supabaseKey) {\r\n    throw new Error('Missing Supabase environment variables')\r\n}\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseKey)\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM;AAEN;;AAIO,MAAM,WAAW,IAAA,8LAAY,EAAC,aAAa"}},
    {"offset": {"line": 25, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/hooks/useHorizon.ts"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport { supabase } from '@/utils/supabase';\r\n\r\nexport interface PayPeriod {\r\n    id: string;\r\n    start_date: string;\r\n    end_date: string;\r\n    total_income: number;\r\n    is_current: boolean;\r\n}\r\n\r\nexport interface Bucket {\r\n    id: string;\r\n    name: string;\r\n    target_amount: number;\r\n    current_balance: number;\r\n    percentage: number;\r\n    color_hex: string;\r\n}\r\n\r\nexport interface HorizonData {\r\n    currentWeek: PayPeriod | null;\r\n    buckets: Bucket[];\r\n    isLoading: boolean;\r\n    error: string | null;\r\n    refreshData: () => Promise<void>;\r\n}\r\n\r\nexport const useHorizon = (): HorizonData => {\r\n    const [currentWeek, setCurrentWeek] = useState<PayPeriod | null>(null);\r\n    const [buckets, setBuckets] = useState<Bucket[]>([]);\r\n    const [isLoading, setIsLoading] = useState(true);\r\n    const [error, setError] = useState<string | null>(null);\r\n\r\n    const refreshData = async () => {\r\n        try {\r\n            // Only set loading to true if we don't have data yet? \r\n            // Or maybe separate \"isRefetching\"? For now, just keep simple.\r\n            // If we want \"instant\" update, maybe don't toggle loading fully if prefer background refresh?\r\n            // \"Goal: The Total Saved number should jump up instantly\" -> If we set isLoading=true, UI might flash skeleton.\r\n            // Let's keep isLoading managed, but maybe we can optimize UX later. \r\n            // For now, prompt implies standard refetch.\r\n            setIsLoading(true);\r\n            setError(null);\r\n\r\n            // Fetch Current Pay Period\r\n            const { data: weekData, error: weekError } = await supabase\r\n                .from('pay_periods')\r\n                .select('*')\r\n                .eq('is_current', true)\r\n                .limit(1)\r\n                .maybeSingle();\r\n\r\n            if (weekError) throw weekError;\r\n\r\n            let effectiveWeek = weekData;\r\n\r\n            // Fallback: If no active week found, use a \"Mock Week\" so UI renders\r\n            if (!effectiveWeek) {\r\n                const today = new Date();\r\n                const nextWeek = new Date(today);\r\n                nextWeek.setDate(today.getDate() + 7);\r\n\r\n                effectiveWeek = {\r\n                    id: 'mock-week',\r\n                    start_date: today.toISOString(),\r\n                    end_date: nextWeek.toISOString(),\r\n                    total_income: 0,\r\n                    is_current: true\r\n                };\r\n            }\r\n\r\n            // Fetch Allocation Buckets\r\n            const { data: bucketsData, error: bucketsError } = await supabase\r\n                .from('allocation_buckets')\r\n                .select('*');\r\n\r\n            if (bucketsError) throw bucketsError;\r\n\r\n            setCurrentWeek(effectiveWeek);\r\n            setBuckets(bucketsData || []);\r\n        } catch (err: any) {\r\n            console.error(\"Supabase Error:\", err.message);\r\n            setError(err.message || 'Failed to fetch data');\r\n        } finally {\r\n            setIsLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        refreshData();\r\n    }, []);\r\n\r\n    return { currentWeek, buckets, isLoading, error, refreshData };\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AA2BO,MAAM,aAAa;IACtB,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAmB;IACjE,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAW,EAAE;IACnD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,iNAAQ,EAAC;IAC3C,MAAM,CAAC,OAAO,SAAS,GAAG,IAAA,iNAAQ,EAAgB;IAElD,MAAM,cAAc;QAChB,IAAI;YACA,uDAAuD;YACvD,+DAA+D;YAC/D,8FAA8F;YAC9F,gHAAgH;YAChH,qEAAqE;YACrE,4CAA4C;YAC5C,aAAa;YACb,SAAS;YAET,2BAA2B;YAC3B,MAAM,EAAE,MAAM,QAAQ,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,oIAAQ,CACtD,IAAI,CAAC,eACL,MAAM,CAAC,KACP,EAAE,CAAC,cAAc,MACjB,KAAK,CAAC,GACN,WAAW;YAEhB,IAAI,WAAW,MAAM;YAErB,IAAI,gBAAgB;YAEpB,qEAAqE;YACrE,IAAI,CAAC,eAAe;gBAChB,MAAM,QAAQ,IAAI;gBAClB,MAAM,WAAW,IAAI,KAAK;gBAC1B,SAAS,OAAO,CAAC,MAAM,OAAO,KAAK;gBAEnC,gBAAgB;oBACZ,IAAI;oBACJ,YAAY,MAAM,WAAW;oBAC7B,UAAU,SAAS,WAAW;oBAC9B,cAAc;oBACd,YAAY;gBAChB;YACJ;YAEA,2BAA2B;YAC3B,MAAM,EAAE,MAAM,WAAW,EAAE,OAAO,YAAY,EAAE,GAAG,MAAM,oIAAQ,CAC5D,IAAI,CAAC,sBACL,MAAM,CAAC;YAEZ,IAAI,cAAc,MAAM;YAExB,eAAe;YACf,WAAW,eAAe,EAAE;QAChC,EAAE,OAAO,KAAU;YACf,QAAQ,KAAK,CAAC,mBAAmB,IAAI,OAAO;YAC5C,SAAS,IAAI,OAAO,IAAI;QAC5B,SAAU;YACN,aAAa;QACjB;IACJ;IAEA,IAAA,kNAAS,EAAC;QACN;IACJ,GAAG,EAAE;IAEL,OAAO;QAAE;QAAa;QAAS;QAAW;QAAO;IAAY;AACjE"}},
    {"offset": {"line": 92, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/components/ui/Card.tsx"],"sourcesContent":["import React from 'react';\r\n\r\ninterface CardProps {\r\n    children: React.ReactNode;\r\n    className?: string;\r\n    title?: string;\r\n}\r\n\r\nexport const Card = ({ children, className = '', title }: CardProps) => {\r\n    return (\r\n        <div className={`bg-white rounded-organic shadow-sm border border-[#F2F1ED] p-6 ${className}`}>\r\n            {title && (\r\n                <h3 className=\"text-text-charcoal font-bold tracking-tight text-xl mb-4\">\r\n                    {title}\r\n                </h3>\r\n            )}\r\n            {children}\r\n        </div>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;;AAQO,MAAM,OAAO,CAAC,EAAE,QAAQ,EAAE,YAAY,EAAE,EAAE,KAAK,EAAa;IAC/D,qBACI,8OAAC;QAAI,WAAW,CAAC,+DAA+D,EAAE,WAAW;;YACxF,uBACG,8OAAC;gBAAG,WAAU;0BACT;;;;;;YAGR;;;;;;;AAGb"}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/components/ui/Button.tsx"],"sourcesContent":["import React from 'react';\r\n\r\ninterface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {\r\n    variant?: 'primary' | 'secondary';\r\n    children: React.ReactNode;\r\n}\r\n\r\nexport const Button = ({ variant = 'primary', children, className = '', ...props }: ButtonProps) => {\r\n    const baseStyles = \"px-6 py-3 rounded-xl font-medium transition-colors duration-200 cursor-pointer\";\r\n    const variants = {\r\n        primary: \"bg-primary-green text-white hover:bg-[#3d4d40]\",\r\n        secondary: \"bg-soft-sage text-text-charcoal hover:bg-[#dce3dc]\",\r\n    };\r\n\r\n    return (\r\n        <button\r\n            className={`${baseStyles} ${variants[variant]} ${className}`}\r\n            {...props}\r\n        >\r\n            {children}\r\n        </button>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;;AAOO,MAAM,SAAS,CAAC,EAAE,UAAU,SAAS,EAAE,QAAQ,EAAE,YAAY,EAAE,EAAE,GAAG,OAAoB;IAC3F,MAAM,aAAa;IACnB,MAAM,WAAW;QACb,SAAS;QACT,WAAW;IACf;IAEA,qBACI,8OAAC;QACG,WAAW,GAAG,WAAW,CAAC,EAAE,QAAQ,CAAC,QAAQ,CAAC,CAAC,EAAE,WAAW;QAC3D,GAAG,KAAK;kBAER;;;;;;AAGb"}},
    {"offset": {"line": 148, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/components/dashboard/IncomeInput.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Card } from '../ui/Card';\r\nimport { Button } from '../ui/Button';\r\n\r\ninterface IncomeInputProps {\r\n    amount: string;\r\n    onAmountChange: (value: string) => void;\r\n    onAllocate: () => void;\r\n    isAllocating: boolean;\r\n    showSuccess: boolean;\r\n}\r\n\r\nexport const IncomeInput = ({ amount, onAmountChange, onAllocate, isAllocating, showSuccess }: IncomeInputProps) => {\r\n    return (\r\n        <Card title=\"Income Input\" className=\"h-full\">\r\n            <div className=\"flex flex-col h-full justify-between gap-6\">\r\n                <div>\r\n                    <label htmlFor=\"income\" className=\"block text-sm font-medium text-text-charcoal mb-2\">\r\n                        Enter this week's income\r\n                    </label>\r\n                    <div className=\"relative\">\r\n                        <span className=\"absolute left-4 top-1/2 -translate-y-1/2 text-gray-500 font-medium\">$</span>\r\n                        <input\r\n                            type=\"number\"\r\n                            id=\"income\"\r\n                            value={amount}\r\n                            onChange={(e) => onAmountChange(e.target.value)}\r\n                            disabled={isAllocating}\r\n                            className=\"w-full pl-8 pr-4 py-3 bg-[#F9F9F7] rounded-xl border-none focus:ring-2 focus:ring-primary-green/20 focus:outline-none transition-all text-lg font-medium text-text-charcoal placeholder:text-gray-400 disabled:opacity-50\"\r\n                            placeholder=\"0.00\"\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-3\">\r\n                    <Button\r\n                        onClick={onAllocate}\r\n                        disabled={isAllocating || !amount || parseFloat(amount) <= 0}\r\n                        className=\"w-full bg-[#4A5D4E] text-white rounded-xl hover:bg-[#3d4d40] disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                        {isAllocating ? 'Saving...' : 'Allocate Funds'}\r\n                    </Button>\r\n                    {showSuccess && (\r\n                        <p className=\"text-sm text-center text-green-600 font-medium animate-fade-in-up\">\r\n                            âœ“ Allocated!\r\n                        </p>\r\n                    )}\r\n                    {!showSuccess && (\r\n                        <p className=\"text-xs text-center text-gray-500\">\r\n                            Funds will be distributed based on your bucket settings.\r\n                        </p>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </Card>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AACA;AACA;;;;AAUO,MAAM,cAAc,CAAC,EAAE,MAAM,EAAE,cAAc,EAAE,UAAU,EAAE,YAAY,EAAE,WAAW,EAAoB;IAC3G,qBACI,8OAAC,wIAAI;QAAC,OAAM;QAAe,WAAU;kBACjC,cAAA,8OAAC;YAAI,WAAU;;8BACX,8OAAC;;sCACG,8OAAC;4BAAM,SAAQ;4BAAS,WAAU;sCAAoD;;;;;;sCAGtF,8OAAC;4BAAI,WAAU;;8CACX,8OAAC;oCAAK,WAAU;8CAAqE;;;;;;8CACrF,8OAAC;oCACG,MAAK;oCACL,IAAG;oCACH,OAAO;oCACP,UAAU,CAAC,IAAM,eAAe,EAAE,MAAM,CAAC,KAAK;oCAC9C,UAAU;oCACV,WAAU;oCACV,aAAY;;;;;;;;;;;;;;;;;;8BAKxB,8OAAC;oBAAI,WAAU;;sCACX,8OAAC,4IAAM;4BACH,SAAS;4BACT,UAAU,gBAAgB,CAAC,UAAU,WAAW,WAAW;4BAC3D,WAAU;sCAET,eAAe,cAAc;;;;;;wBAEjC,6BACG,8OAAC;4BAAE,WAAU;sCAAoE;;;;;;wBAIpF,CAAC,6BACE,8OAAC;4BAAE,WAAU;sCAAoC;;;;;;;;;;;;;;;;;;;;;;;AAQzE"}},
    {"offset": {"line": 263, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/components/dashboard/BucketAllocations.tsx"],"sourcesContent":["import React from 'react';\r\nimport Link from 'next/link';\r\nimport { Card } from '../ui/Card';\r\nimport { ProgressBar } from '../ui/ProgressBar';\r\nimport { ProjectedBucket } from '../../utils/finance';\r\n\r\ninterface BucketAllocationsProps {\r\n    buckets: ProjectedBucket[];\r\n}\r\n\r\nexport const BucketAllocations = ({ buckets }: BucketAllocationsProps) => {\r\n    const totalTarget = buckets.reduce((acc, b) => acc + b.target_amount, 0);\r\n    const totalCurrent = buckets.reduce((acc, b) => acc + (b.current_balance || 0), 0);\r\n    const totalProjected = buckets.reduce((acc, b) => acc + (b.projected_balance || 0), 0);\r\n    const hasProjection = totalProjected > totalCurrent;\r\n\r\n    return (\r\n        <Card title=\"Bucket Allocations\" className=\"h-full\">\r\n            <div className=\"space-y-6\">\r\n                <div className=\"flex justify-between items-end mb-2\">\r\n                    <div>\r\n                        <p className=\"text-sm text-gray-500\">Total Saved</p>\r\n                        <p className=\"text-2xl font-bold text-text-charcoal\">\r\n                            ${totalCurrent.toLocaleString()}\r\n                            {hasProjection && (\r\n                                <span className=\"text-gray-400 text-lg font-normal ml-2\">\r\n                                    {`-> $${totalProjected.toLocaleString()}`}\r\n                                </span>\r\n                            )}\r\n                        </p>\r\n                    </div>\r\n                    <div className=\"text-right\">\r\n                        <p className=\"text-sm text-gray-500\">Goal</p>\r\n                        <p className=\"font-medium text-text-charcoal\">${totalTarget.toLocaleString()}</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-5\">\r\n                    {buckets.map((bucket) => {\r\n                        const current = bucket.current_balance || 0;\r\n                        const projected = bucket.projected_balance || current;\r\n                        const isProjected = projected > current;\r\n\r\n                        // Calculate percentages for bars\r\n                        // Solid bar width (based on current)\r\n                        const currentPercent = Math.min((current / bucket.target_amount) * 100, 100);\r\n\r\n                        // Ghost bar width (the added part)\r\n                        // If projected exceeds target, we cap visually at 100% total\r\n                        const projectedTotalPercent = Math.min((projected / bucket.target_amount) * 100, 100);\r\n                        const ghostPercent = Math.max(0, projectedTotalPercent - currentPercent);\r\n\r\n                        return (\r\n                            <div key={bucket.id}>\r\n                                <div className=\"flex justify-between text-sm mb-2\">\r\n                                    <span className=\"font-medium\">{bucket.name}</span>\r\n                                    <span className=\"text-gray-500\">\r\n                                        ${current.toLocaleString()}\r\n                                        {isProjected && ` -> $${projected.toLocaleString()}`}\r\n                                        {' / '}${bucket.target_amount.toLocaleString()}\r\n                                    </span>\r\n                                </div>\r\n\r\n                                {/* Custom Progress Bar with Ghost Segment */}\r\n                                <div className=\"h-2 w-full bg-[#E9F0E9] rounded-full overflow-hidden flex\">\r\n                                    {/* Solid Bar */}\r\n                                    <div\r\n                                        className=\"h-full bg-[#4A5D4E] transition-all duration-300\"\r\n                                        style={{ width: `${currentPercent}%` }}\r\n                                    />\r\n                                    {/* Ghost Bar */}\r\n                                    {ghostPercent > 0 && (\r\n                                        <div\r\n                                            className=\"h-full bg-[#8FA393] opacity-60 transition-all duration-300\"\r\n                                            style={{ width: `${ghostPercent}%` }}\r\n                                        />\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n                        );\r\n                    })}\r\n                </div>\r\n\r\n                <div className=\"pt-4 border-t border-[#F2F1ED] mt-4\">\r\n                    <Link href=\"/buckets\" className=\"text-[#4A5D4E] text-sm font-medium hover:underline\">\r\n                        Manage Buckets\r\n                    </Link>\r\n                </div>\r\n            </div>\r\n        </Card>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AACA;AACA;;;;AAQO,MAAM,oBAAoB,CAAC,EAAE,OAAO,EAA0B;IACjE,MAAM,cAAc,QAAQ,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,EAAE,aAAa,EAAE;IACtE,MAAM,eAAe,QAAQ,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,CAAC,EAAE,eAAe,IAAI,CAAC,GAAG;IAChF,MAAM,iBAAiB,QAAQ,MAAM,CAAC,CAAC,KAAK,IAAM,MAAM,CAAC,EAAE,iBAAiB,IAAI,CAAC,GAAG;IACpF,MAAM,gBAAgB,iBAAiB;IAEvC,qBACI,8OAAC,wIAAI;QAAC,OAAM;QAAqB,WAAU;kBACvC,cAAA,8OAAC;YAAI,WAAU;;8BACX,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;;8CACG,8OAAC;oCAAE,WAAU;8CAAwB;;;;;;8CACrC,8OAAC;oCAAE,WAAU;;wCAAwC;wCAC/C,aAAa,cAAc;wCAC5B,+BACG,8OAAC;4CAAK,WAAU;sDACX,CAAC,IAAI,EAAE,eAAe,cAAc,IAAI;;;;;;;;;;;;;;;;;;sCAKzD,8OAAC;4BAAI,WAAU;;8CACX,8OAAC;oCAAE,WAAU;8CAAwB;;;;;;8CACrC,8OAAC;oCAAE,WAAU;;wCAAiC;wCAAE,YAAY,cAAc;;;;;;;;;;;;;;;;;;;8BAIlF,8OAAC;oBAAI,WAAU;8BACV,QAAQ,GAAG,CAAC,CAAC;wBACV,MAAM,UAAU,OAAO,eAAe,IAAI;wBAC1C,MAAM,YAAY,OAAO,iBAAiB,IAAI;wBAC9C,MAAM,cAAc,YAAY;wBAEhC,iCAAiC;wBACjC,qCAAqC;wBACrC,MAAM,iBAAiB,KAAK,GAAG,CAAC,AAAC,UAAU,OAAO,aAAa,GAAI,KAAK;wBAExE,mCAAmC;wBACnC,6DAA6D;wBAC7D,MAAM,wBAAwB,KAAK,GAAG,CAAC,AAAC,YAAY,OAAO,aAAa,GAAI,KAAK;wBACjF,MAAM,eAAe,KAAK,GAAG,CAAC,GAAG,wBAAwB;wBAEzD,qBACI,8OAAC;;8CACG,8OAAC;oCAAI,WAAU;;sDACX,8OAAC;4CAAK,WAAU;sDAAe,OAAO,IAAI;;;;;;sDAC1C,8OAAC;4CAAK,WAAU;;gDAAgB;gDAC1B,QAAQ,cAAc;gDACvB,eAAe,CAAC,KAAK,EAAE,UAAU,cAAc,IAAI;gDACnD;gDAAM;gDAAE,OAAO,aAAa,CAAC,cAAc;;;;;;;;;;;;;8CAKpD,8OAAC;oCAAI,WAAU;;sDAEX,8OAAC;4CACG,WAAU;4CACV,OAAO;gDAAE,OAAO,GAAG,eAAe,CAAC,CAAC;4CAAC;;;;;;wCAGxC,eAAe,mBACZ,8OAAC;4CACG,WAAU;4CACV,OAAO;gDAAE,OAAO,GAAG,aAAa,CAAC,CAAC;4CAAC;;;;;;;;;;;;;2BArBzC,OAAO,EAAE;;;;;oBA2B3B;;;;;;8BAGJ,8OAAC;oBAAI,WAAU;8BACX,cAAA,8OAAC,uKAAI;wBAAC,MAAK;wBAAW,WAAU;kCAAqD;;;;;;;;;;;;;;;;;;;;;;AAOzG"}},
    {"offset": {"line": 476, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/components/dashboard/WeeklyCalendar.tsx"],"sourcesContent":["import React from 'react';\r\nimport { Card } from '../ui/Card';\r\nimport { PayPeriod } from '../../hooks/useHorizon';\r\n\r\ninterface WeeklyCalendarProps {\r\n    payPeriods: PayPeriod[];\r\n}\r\n\r\nexport const WeeklyCalendar = ({ payPeriods }: WeeklyCalendarProps) => {\r\n    return (\r\n        <Card title=\"Weekly View\" className=\"h-full\">\r\n            <div className=\"space-y-4\">\r\n                {payPeriods.map((period) => {\r\n                    const startDate = new Date(period.start_date);\r\n                    const endDate = new Date(period.end_date);\r\n                    const dateOptions: Intl.DateTimeFormatOptions = { month: 'short', day: 'numeric' };\r\n                    const dateRange = `${startDate.toLocaleDateString('en-US', dateOptions)} - ${endDate.toLocaleDateString('en-US', dateOptions)}`;\r\n\r\n                    return (\r\n                        <div\r\n                            key={period.id}\r\n                            className={`flex items-center justify-between p-4 rounded-xl border transition-all ${period.is_current\r\n                                ? 'bg-soft-sage/30 border-primary-green/20'\r\n                                : 'bg-white border-[#F2F1ED] hover:border-gray-200'\r\n                                }`}\r\n                        >\r\n                            <div className=\"flex items-center gap-4\">\r\n                                <div className={`w-2 h-2 rounded-full ${period.is_current ? 'bg-primary-green' : 'bg-gray-300'}`} />\r\n                                <div>\r\n                                    <p className={`text-sm font-medium ${period.is_current ? 'text-text-charcoal' : 'text-gray-600'}`}>\r\n                                        {dateRange}\r\n                                    </p>\r\n                                    {period.is_current && <span className=\"text-[10px] uppercase tracking-wider font-bold text-primary-green\">Current Week</span>}\r\n                                </div>\r\n                            </div>\r\n                            <div>\r\n                                <span className=\"font-semibold text-text-charcoal\">${period.total_income.toLocaleString()}</span>\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                })}\r\n\r\n                <div className=\"pt-2 text-center\">\r\n                    <button className=\"bg-[#4A5D4E] text-white px-4 py-2 rounded-xl font-medium hover:bg-[#3d4d40] transition-colors\">\r\n                        View Past Weeks\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </Card>\r\n    );\r\n};\r\n"],"names":[],"mappings":";;;;;AACA;;;AAOO,MAAM,iBAAiB,CAAC,EAAE,UAAU,EAAuB;IAC9D,qBACI,8OAAC,wIAAI;QAAC,OAAM;QAAc,WAAU;kBAChC,cAAA,8OAAC;YAAI,WAAU;;gBACV,WAAW,GAAG,CAAC,CAAC;oBACb,MAAM,YAAY,IAAI,KAAK,OAAO,UAAU;oBAC5C,MAAM,UAAU,IAAI,KAAK,OAAO,QAAQ;oBACxC,MAAM,cAA0C;wBAAE,OAAO;wBAAS,KAAK;oBAAU;oBACjF,MAAM,YAAY,GAAG,UAAU,kBAAkB,CAAC,SAAS,aAAa,GAAG,EAAE,QAAQ,kBAAkB,CAAC,SAAS,cAAc;oBAE/H,qBACI,8OAAC;wBAEG,WAAW,CAAC,uEAAuE,EAAE,OAAO,UAAU,GAChG,4CACA,mDACA;;0CAEN,8OAAC;gCAAI,WAAU;;kDACX,8OAAC;wCAAI,WAAW,CAAC,qBAAqB,EAAE,OAAO,UAAU,GAAG,qBAAqB,eAAe;;;;;;kDAChG,8OAAC;;0DACG,8OAAC;gDAAE,WAAW,CAAC,oBAAoB,EAAE,OAAO,UAAU,GAAG,uBAAuB,iBAAiB;0DAC5F;;;;;;4CAEJ,OAAO,UAAU,kBAAI,8OAAC;gDAAK,WAAU;0DAAoE;;;;;;;;;;;;;;;;;;0CAGlH,8OAAC;0CACG,cAAA,8OAAC;oCAAK,WAAU;;wCAAmC;wCAAE,OAAO,YAAY,CAAC,cAAc;;;;;;;;;;;;;uBAhBtF,OAAO,EAAE;;;;;gBAoB1B;8BAEA,8OAAC;oBAAI,WAAU;8BACX,cAAA,8OAAC;wBAAO,WAAU;kCAAgG;;;;;;;;;;;;;;;;;;;;;;AAOtI"}},
    {"offset": {"line": 597, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/utils/finance.ts"],"sourcesContent":["import { Bucket } from '@/hooks/useHorizon';\r\n\r\nexport interface ProjectedBucket extends Bucket {\r\n    projected_balance: number;\r\n}\r\n\r\n/**\r\n * Calculates projected bucket balances based on income input.\r\n * - Uses the user's explicit 'percentage' for distribution.\r\n * - Rounds to 2 decimal places to act like real money.\r\n * - Enforces the \"Hard Cap\" rule (stops at target_amount).\r\n */\r\nexport const calculateProjections = (income: number, buckets: Bucket[]): ProjectedBucket[] => {\r\n    // If no income or negative, return buckets with projected = current\r\n    if (!income || income <= 0) {\r\n        return buckets.map(b => ({\r\n            ...b,\r\n            projected_balance: b.current_balance || 0\r\n        }));\r\n    }\r\n\r\n    return buckets.map(bucket => {\r\n        // 1. Calculate share based on the Database Percentage (e.g., 50)\r\n        // We expect bucket.percentage to be a number like 50, 30, 20.\r\n        const percentage = bucket.percentage || 0;\r\n        let potentialAdd = income * (percentage / 100);\r\n\r\n        // 2. Round down to 2 decimals immediately (Money Logic)\r\n        // This prevents numbers like 322.581\r\n        potentialAdd = Math.floor(potentialAdd * 100) / 100;\r\n\r\n        const currentBalance = bucket.current_balance || 0;\r\n\r\n        // 3. HARD CAP RULE:\r\n        // Calculate how much space is strictly left in the bucket.\r\n        const spaceRemaining = Math.max(0, bucket.target_amount - currentBalance);\r\n\r\n        // 4. The actual amount to add is the smaller of:\r\n        //    a) The calculated percentage share\r\n        //    b) The remaining space (to prevent overflow)\r\n        const actualAdd = Math.min(potentialAdd, spaceRemaining);\r\n\r\n        return {\r\n            ...bucket,\r\n            projected_balance: currentBalance + actualAdd\r\n        };\r\n    });\r\n};"],"names":[],"mappings":";;;;AAYO,MAAM,uBAAuB,CAAC,QAAgB;IACjD,oEAAoE;IACpE,IAAI,CAAC,UAAU,UAAU,GAAG;QACxB,OAAO,QAAQ,GAAG,CAAC,CAAA,IAAK,CAAC;gBACrB,GAAG,CAAC;gBACJ,mBAAmB,EAAE,eAAe,IAAI;YAC5C,CAAC;IACL;IAEA,OAAO,QAAQ,GAAG,CAAC,CAAA;QACf,iEAAiE;QACjE,8DAA8D;QAC9D,MAAM,aAAa,OAAO,UAAU,IAAI;QACxC,IAAI,eAAe,SAAS,CAAC,aAAa,GAAG;QAE7C,wDAAwD;QACxD,qCAAqC;QACrC,eAAe,KAAK,KAAK,CAAC,eAAe,OAAO;QAEhD,MAAM,iBAAiB,OAAO,eAAe,IAAI;QAEjD,oBAAoB;QACpB,2DAA2D;QAC3D,MAAM,iBAAiB,KAAK,GAAG,CAAC,GAAG,OAAO,aAAa,GAAG;QAE1D,iDAAiD;QACjD,wCAAwC;QACxC,kDAAkD;QAClD,MAAM,YAAY,KAAK,GAAG,CAAC,cAAc;QAEzC,OAAO;YACH,GAAG,MAAM;YACT,mBAAmB,iBAAiB;QACxC;IACJ;AACJ"}},
    {"offset": {"line": 635, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/app/actions/allocate.ts"],"sourcesContent":["'use server';\r\n\r\nimport { createClient } from '@supabase/supabase-js';\r\nimport { revalidatePath } from 'next/cache';\r\nimport { Bucket } from '@/hooks/useHorizon';\r\nimport { calculateProjections } from '@/utils/finance';\r\n\r\n// Initialize Supabase Admin Client (Service Role)\r\n// This bypasses RLS to ensure we can update any user's data securely from the server\r\nconst supabaseAdmin = createClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n    process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n);\r\n\r\n/**\r\n * Allocates income to buckets and updates the database.\r\n * \r\n * @param userId The ID of the user (not strictly used if buckets have IDs, but good for validation if needed)\r\n * @param income The amount of income to allocate\r\n * @param buckets The current state of buckets (mostly for IDs and targets)\r\n */\r\nexport async function allocateIncome(userId: string, income: number, buckets: Bucket[]) {\r\n    try {\r\n        if (!income || income <= 0) {\r\n            throw new Error(\"Invalid income amount.\");\r\n        }\r\n\r\n        if (!buckets || buckets.length === 0) {\r\n            throw new Error(\"No buckets to allocate to.\");\r\n        }\r\n\r\n        // 1. Recalculate projections server-side for safety\r\n        // We trust the bucket IDs and Targets from the client (for now), but we recalculate the split.\r\n        // In a real app, we might re-fetch buckets from DB to ensure targets haven't changed.\r\n        // For this MVP, we'll use the passed buckets but recalculate the math.\r\n        const projectedBuckets = calculateProjections(income, buckets);\r\n\r\n        // 2. Perform updates sequentially\r\n        // Supabase doesn't support multi-table transactions via JS client easily without RPC.\r\n        // Sequential updates are fine for this scale.\r\n\r\n        const updates = projectedBuckets.map(async (bucket) => {\r\n            // Only update if there's a change or strictly if projected > current?\r\n            // Actually, we want to commit the projected_balance as the new current_balance.\r\n\r\n            const { error } = await supabaseAdmin\r\n                .from('allocation_buckets')\r\n                .update({ current_balance: bucket.projected_balance })\r\n                .eq('id', bucket.id);\r\n\r\n            if (error) {\r\n                console.error(`Failed to update bucket ${bucket.name}:`, error);\r\n                throw new Error(`Failed to update bucket ${bucket.name}`);\r\n            }\r\n        });\r\n\r\n        await Promise.all(updates);\r\n\r\n        // 3. Revalidate the dashboard\r\n        revalidatePath('/horizon');\r\n\r\n        return { success: true };\r\n    } catch (error: any) {\r\n        console.error(\"Allocation Error:\", error);\r\n        return { success: false, error: error.message };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;MAqBsB,wBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA,kDAAA"}},
    {"offset": {"line": 649, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Trinj/OneDrive/Desktop/fisc-financial-backend/src/app/horizon/page.tsx"],"sourcesContent":["'use client';\r\n\r\nimport React, { useState, useMemo } from 'react';\r\nimport { useHorizon } from '@/hooks/useHorizon';\r\nimport { IncomeInput } from '@/components/dashboard/IncomeInput';\r\nimport { BucketAllocations } from '@/components/dashboard/BucketAllocations';\r\nimport { WeeklyCalendar } from '@/components/dashboard/WeeklyCalendar';\r\nimport { calculateProjections } from '@/utils/finance';\r\nimport { allocateIncome } from '@/app/actions/allocate';\r\n\r\nexport default function HorizonPage() {\r\n    const { currentWeek, buckets, isLoading, error, refreshData } = useHorizon();\r\n    const [incomeInput, setIncomeInput] = useState('');\r\n    const [isAllocating, setIsAllocating] = useState(false);\r\n    const [showSuccess, setShowSuccess] = useState(false);\r\n\r\n    const handleAllocate = async () => {\r\n        const income = parseFloat(incomeInput);\r\n        if (!income || income <= 0) return;\r\n\r\n        try {\r\n            setIsAllocating(true);\r\n            const result = await allocateIncome('user-id-placeholder', income, buckets);\r\n\r\n            if (result.success) {\r\n                setIncomeInput('');\r\n                setShowSuccess(true);\r\n                // Refresh data instantly\r\n                await refreshData();\r\n\r\n                // Hide success message after 3 seconds\r\n                setTimeout(() => setShowSuccess(false), 3000);\r\n            } else {\r\n                alert(`Allocation failed: ${result.error}`);\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Allocation failed:\", err);\r\n            alert(\"An unexpected error occurred.\");\r\n        } finally {\r\n            setIsAllocating(false);\r\n        }\r\n    };\r\n\r\n    // Calculate projected buckets based on input\r\n    const projectedBuckets = useMemo(() => {\r\n        // Parse input amount (default to 0 if invalid)\r\n        const income = parseFloat(incomeInput) || 0;\r\n\r\n        return calculateProjections(income, buckets);\r\n    }, [buckets, incomeInput]);\r\n\r\n    if (isLoading) {\r\n        return (\r\n            <div className=\"min-h-screen flex items-center justify-center bg-[#F9F9F7] font-sans text-[#2D2D2D]\">\r\n                <div className=\"text-center animate-pulse\">\r\n                    <h2 className=\"text-xl font-medium text-text-charcoal mb-2\">We're updating your balances...</h2>\r\n                    <p className=\"text-gray-400 text-sm\">Just a moment while we crunch the numbers.</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (error) {\r\n        return (\r\n            <div className=\"min-h-screen flex items-center justify-center bg-[#F9F9F7] font-sans text-[#2D2D2D]\">\r\n                <div className=\"text-center\">\r\n                    <h2 className=\"text-xl font-medium text-red-600 mb-2\">That didn't quite work, let's try again.</h2>\r\n                    <p className=\"text-gray-400 text-sm\">{error}</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <main className=\"min-h-screen bg-[#F9F9F7] p-8 md:p-10 font-sans text-[#2D2D2D]\">\r\n            <div className=\"max-w-7xl mx-auto space-y-8\">\r\n                <header className=\"mb-10\">\r\n                    <h1 className=\"text-3xl md:text-4xl font-bold text-text-charcoal tracking-tight\">\r\n                        Financial Horizon\r\n                    </h1>\r\n                    <p className=\"text-gray-500 mt-2 text-lg\">\r\n                        Your weekly financial health at a glance.\r\n                    </p>\r\n                </header>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8\">\r\n                    {/* Card 1: Income Input */}\r\n                    <div className=\"lg:col-span-1\">\r\n                        <IncomeInput\r\n                            amount={incomeInput}\r\n                            onAmountChange={setIncomeInput}\r\n                            onAllocate={handleAllocate}\r\n                            isAllocating={isAllocating}\r\n                            showSuccess={showSuccess}\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Card 2: Weekly Calendar - Show current week + maybe placeholders if needed, but for now just pass current week in array if it exists */}\r\n                    <div className=\"lg:col-span-1\">\r\n                        <WeeklyCalendar payPeriods={currentWeek ? [currentWeek] : []} />\r\n                    </div>\r\n\r\n                    {/* Card 3: Bucket Allocations - Pass PROJECTED buckets */}\r\n                    <div className=\"lg:col-span-1\">\r\n                        <BucketAllocations buckets={projectedBuckets} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </main>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;;;;;;;;;AAUe,SAAS;IACpB,MAAM,EAAE,WAAW,EAAE,OAAO,EAAE,SAAS,EAAE,KAAK,EAAE,WAAW,EAAE,GAAG,IAAA,wIAAU;IAC1E,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAC/C,MAAM,CAAC,cAAc,gBAAgB,GAAG,IAAA,iNAAQ,EAAC;IACjD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,iNAAQ,EAAC;IAE/C,MAAM,iBAAiB;QACnB,MAAM,SAAS,WAAW;QAC1B,IAAI,CAAC,UAAU,UAAU,GAAG;QAE5B,IAAI;YACA,gBAAgB;YAChB,MAAM,SAAS,MAAM,IAAA,+KAAc,EAAC,uBAAuB,QAAQ;YAEnE,IAAI,OAAO,OAAO,EAAE;gBAChB,eAAe;gBACf,eAAe;gBACf,yBAAyB;gBACzB,MAAM;gBAEN,uCAAuC;gBACvC,WAAW,IAAM,eAAe,QAAQ;YAC5C,OAAO;gBACH,MAAM,CAAC,mBAAmB,EAAE,OAAO,KAAK,EAAE;YAC9C;QACJ,EAAE,OAAO,KAAK;YACV,QAAQ,KAAK,CAAC,sBAAsB;YACpC,MAAM;QACV,SAAU;YACN,gBAAgB;QACpB;IACJ;IAEA,6CAA6C;IAC7C,MAAM,mBAAmB,IAAA,gNAAO,EAAC;QAC7B,+CAA+C;QAC/C,MAAM,SAAS,WAAW,gBAAgB;QAE1C,OAAO,IAAA,+IAAoB,EAAC,QAAQ;IACxC,GAAG;QAAC;QAAS;KAAY;IAEzB,IAAI,WAAW;QACX,qBACI,8OAAC;YAAI,WAAU;sBACX,cAAA,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAG,WAAU;kCAA8C;;;;;;kCAC5D,8OAAC;wBAAE,WAAU;kCAAwB;;;;;;;;;;;;;;;;;IAIrD;IAEA,IAAI,OAAO;QACP,qBACI,8OAAC;YAAI,WAAU;sBACX,cAAA,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAG,WAAU;kCAAwC;;;;;;kCACtD,8OAAC;wBAAE,WAAU;kCAAyB;;;;;;;;;;;;;;;;;IAItD;IAEA,qBACI,8OAAC;QAAK,WAAU;kBACZ,cAAA,8OAAC;YAAI,WAAU;;8BACX,8OAAC;oBAAO,WAAU;;sCACd,8OAAC;4BAAG,WAAU;sCAAmE;;;;;;sCAGjF,8OAAC;4BAAE,WAAU;sCAA6B;;;;;;;;;;;;8BAK9C,8OAAC;oBAAI,WAAU;;sCAEX,8OAAC;4BAAI,WAAU;sCACX,cAAA,8OAAC,6JAAW;gCACR,QAAQ;gCACR,gBAAgB;gCAChB,YAAY;gCACZ,cAAc;gCACd,aAAa;;;;;;;;;;;sCAKrB,8OAAC;4BAAI,WAAU;sCACX,cAAA,8OAAC,mKAAc;gCAAC,YAAY,cAAc;oCAAC;iCAAY,GAAG,EAAE;;;;;;;;;;;sCAIhE,8OAAC;4BAAI,WAAU;sCACX,cAAA,8OAAC,yKAAiB;gCAAC,SAAS;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMpD"}}]
}